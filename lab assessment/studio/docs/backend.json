{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user of the LabTracker Pro application.",
      "properties": {
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "fullName": {
          "type": "string",
          "description": "User's full name."
        },
        "role": {
          "type": "string",
          "description": "User's role (e.g., teacher, student)."
        },
        "schoolId": {
          "type": "string",
          "description": "User's 7-digit school ID."
        }
      },
      "required": [
        "email",
        "fullName",
        "role",
        "schoolId"
      ]
    },
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents a lab course.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Course entity."
        },
        "courseCode": {
          "type": "string",
          "description": "Course code (e.g., CS101)."
        },
        "courseName": {
          "type": "string",
          "description": "Course Name (e.g., Introduction to Computer Science)."
        },
        "teacherId": {
          "type": "string",
          "description": "Reference to UserProfile (Teacher). (Relationship: UserProfile 1:N Course)"
        },
        "teacherName": {
          "type": "string",
          "description": "Denormalized teacher name for display purposes."
        },
        "joinCode": {
          "type": "string",
          "description": "Student join code."
       },
        "credit": {
          "type": "number",
          "description": "Credit value for the course (e.g., 0.75, 1.5), used to calculate total marks."
        }
      },
      "required": [
        "id",
        "courseCode",
        "courseName",
        "teacherId",
        "teacherName",  
        "joinCode",
        "credit"
      ]
    },
    "CourseJoinCode": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CourseJoinCode",
      "type": "object",
      "description": "Maps a unique join code to a course and teacher for easy lookup.",
      "properties": {
        "courseId": {
          "type": "string",
          "description": "The ID of the course associated with this join code."
        },
        "teacherId": {
          "type": "string",
          "description": "The ID of the teacher who owns the course."
        }
      },
      "required": ["courseId", "teacherId"]
    },
    "Enrollment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Enrollment",
      "type": "object",
      "description": "Represents a student's enrollment in a course.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Enrollment entity."
        },
        "studentId": {
          "type": "string",
          "description": "Reference to UserProfile (Student). (Relationship: UserProfile 1:N Enrollment)"
        },
        "studentName": {
          "type": "string",
          "description": "Denormalized student name for display purposes."
        },
        "studentEmail": {
          "type": "string",
          "description": "Denormalized student email for display purposes."
        },
        "studentSchoolId": {
          "type": "string",
          "description": "Denormalized student school ID for display purposes."
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N Enrollment)"
        },
        "teacherId": {
            "type": "string",
            "description": "Denormalized teacher ID for security rules."
        },
        "enrollmentDate": {
          "type": "string",
          "description": "Date of enrollment.",
          "format": "date-time"
        },
        "finalGrade": {
            "type": "string",
            "description": "The calculated final letter grade for the student in this course."
        },
        "totalMarks": {
            "type": "number",
            "description": "The calculated total marks for the student in this course."
        }
      },
      "required": [
        "id",
        "studentId",
        "studentName",
        "studentEmail",
        "courseId",
        "teacherId",
        "enrollmentDate"
      ]
    },
    "Attendance": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Attendance",
      "type": "object",
      "description": "Represents a student's attendance record for a specific week.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Attendance entity."
        },
        "enrollmentId": {
          "type": "string",
          "description": "Reference to Enrollment. (Relationship: Enrollment 1:N Attendance)"
        },
        "week": {
          "type": "number",
          "description": "Week number."
        },
        "date": {
          "type": "string",
          "description": "The date of the attendance record.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Attendance status (e.g., Present, Absent)."
        }
      },
      "required": [
        "id",
        "enrollmentId",
        "week",
        "date",
        "status"
      ]
    },
    "Performance": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Performance",
      "type": "object",
      "description": "Represents a student's performance record for a specific week in a course.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Performance entity."
        },
        "enrollmentId": {
          "type": "string",
          "description": "Reference to Enrollment. (Relationship: Enrollment 1:N Performance)"
        },
        "week": {
          "type": "number",
          "description": "Week number."
        },
        "labMarks": {
          "type": "number",
          "description": "Marks obtained in the lab for the week."
        },
        "quizScore": {
          "type": "number",
          "description": "Score obtained in the quiz for the week."
        },
        "vivaScore": {
          "type": "number",
          "description": "Score obtained in the viva for the week."
        }
      },
      "required": [
        "id",
        "enrollmentId",
        "week",
        "labMarks",
        "quizScore",
        "vivaScore"
      ]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}",
        "definition": {
          "entityName": "Course",
          "schema": {
            "$ref": "#/backend/entities/Course"
          },
          "description": "Top-level collection for all courses, allows for easier querying.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier for the course."
            }
          ]
        }
      },
      {
        "path": "/courseJoinCodes/{joinCode}",
        "definition": {
          "entityName": "CourseJoinCode",
          "schema": {
            "$ref": "#/backend/entities/CourseJoinCode"
          },
          "description": "Maps join codes to course and teacher IDs for easy student enrollment.",
          "params": [
            {
              "name": "joinCode",
              "description": "The unique code for joining a course."
            }
          ]
        }
      },
      {
        "path": "/enrollments/{enrollmentId}",
        "definition": {
          "entityName": "Enrollment",
          "schema": {
            "$ref": "#/backend/entities/Enrollment"
          },
          "description": "Stores enrollment data, including studentId and courseId. Enables queries by student or course.",
          "params": [
            {
              "name": "enrollmentId",
              "description": "The unique identifier for the enrollment."
            }
          ]
        }
      },
      {
        "path": "/enrollments/{enrollmentId}/attendance/{attendanceId}",
        "definition": {
          "entityName": "Attendance",
          "schema": {
            "$ref": "#/backend/entities/Attendance"
          },
          "description": "Stores attendance records for each enrollment.",
          "params": [
            {
              "name": "enrollmentId",
              "description": "The unique identifier for the enrollment."
            },
            {
              "name": "attendanceId",
              "description": "The unique identifier for the attendance record."
            }
          ]
        }
      },
      {
        "path": "/enrollments/{enrollmentId}/performance/{performanceId}",
        "definition": {
          "entityName": "Performance",
          "schema": {
            "$ref": "#/backend/entities/Performance"
          },
          "description": "Stores performance records for each enrollment.",
          "params": [
            {
              "name": "enrollmentId",
              "description": "The unique identifier for the enrollment."
            },
            {
              "name": "performanceId",
              "description": "The unique identifier for the performance record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is updated for better query capabilities and scalability. Courses are moved to a top-level collection `/courses` to allow students to query for them using a join code, which was not possible with the nested structure. A new `/courseJoinCodes` collection is introduced to map a unique join code to a course and teacher, enabling efficient lookups during the enrollment process. This change is critical for the 'join course' feature to work securely and efficiently. User profiles and enrollments remain in their respective top-level collections. This hybrid model balances data normalization and denormalization, improving query performance and maintaining clear ownership and security boundaries."
  }
}
